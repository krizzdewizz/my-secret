<div class="title-area">
  <my-secret-banner></my-secret-banner>
  <div class="toolbar" *ngIf="state.state === 'open'">
    <input
      class="search"
      [(ngModel)]="searchTerm"
      type="search"
      placeholder="Search..."
    />
    <button (click)="addSecret()" title="Add" class="icon">
      <my-secret-plus-icon></my-secret-plus-icon>
    </button>
    <button
      (click)="saveSecrets()"
      [class.changed]="changed"
      title="Save"
      class="icon"
    >
      <my-secret-save-icon></my-secret-save-icon>
    </button>
    <button (click)="downloadSecrets()" title="Download" class="icon">
      <my-secret-download-icon></my-secret-download-icon>
    </button>
    <button (click)="exportSecrets()" title="Export" class="icon">
      <my-secret-export-icon></my-secret-export-icon>
    </button>
    <button (click)="reset()" title="Delete whole Secret" class="icon">
      <my-secret-trash-icon></my-secret-trash-icon>
    </button>
  </div>
</div>

<div class="state-container" [ngSwitch]="state.state">
  <div class="initial" *ngSwitchCase="'initial'">
    <span class="initial-title">{{ initialTitle }}</span>

    <div *ngIf="initialPassword; else newOrUpload" class="password">
      <div class="input-container">
        <input
          (keydown.enter)="open()"
          #passwordEl
          [(ngModel)]="password"
          type="password"
          autocomplete="off"
        />
      </div>

      <button (click)="createSecret()" [disabled]="!password">Save</button>
    </div>

    <ng-template #newOrUpload>
      <div class="new-or-upload">
        <input
          #fileInput
          type="file"
          hidden=""
          (change)="onFileChange($event)"
        />

        <button (click)="createNew()">Create New</button>
        <button
          title="Upload"
          (click)="uploadAction = 'upload'; fileInput.click()"
          class="upload-file"
        >
          Upload
        </button>
        <button
          title="Import"
          (click)="uploadAction = 'import'; fileInput.click()"
          class="upload-file"
        >
          Import
        </button>
      </div>
    </ng-template>
  </div>

  <div class="initial" *ngSwitchCase="'secretsPresent'">
    <span>Enter password to unlock secret</span>
    <div class="password">
      <div class="input-container">
        <input
          (keydown.enter)="unlock()"
          #passwordEl
          [(ngModel)]="password"
          type="password"
          autocomplete="off"
        />
      </div>
      <button (click)="unlock()" [disabled]="!password">Unlock</button>

      <div class="reset-icon">
        <my-secret-trash-icon
          class="icon"
          title="Delete whole Secret"
          (click)="reset()"
        ></my-secret-trash-icon>
      </div>
    </div>
  </div>

  <div class="open" *ngSwitchCase="'open'">
    <div class="secret-container">
      <ng-container *ngFor="let secret of filteredSecrets">
        <input
          type="text"
          placeholder="Name"
          [(ngModel)]="secret.name"
          (ngModelChange)="onChanged()"
        />
        <input
          type="text"
          placeholder="User"
          [(ngModel)]="secret.user"
          (ngModelChange)="onChanged()"
        />
        <div class="secret-password">
          <my-secret-eye-icon
            class="icon"
            (click)="secret.visible = !secret.visible"
          ></my-secret-eye-icon>
          <input
            placeholder="Password"
            [type]="secret.visible ? 'text' : 'password'"
            [(ngModel)]="secret.password"
            (ngModelChange)="onChanged()"
          />
        </div>
        <div class="infos">
          <input
            type="text"
            placeholder="Info 0"
            [(ngModel)]="secret.info0"
            (ngModelChange)="onChanged()"
          />
          <input
            type="text"
            placeholder="Info 1"
            [(ngModel)]="secret.info1"
            (ngModelChange)="onChanged()"
          />
        </div>
        <div
          class="delete-secret"
          title="Delete"
          (click)="deleteSecret(secret)"
        >
          <my-secret-trash-icon class="icon"></my-secret-trash-icon>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<div class="error">{{ error }}</div>

<!--<pre>{{ secrets | json }}</pre>-->
