<my-secret-banner></my-secret-banner>

<div class="state-container" [ngSwitch]="state.state">
  <div class="initial" *ngSwitchCase="'initial'">
    <span>{{ initialTitle }}</span>

    <div *ngIf="initialPassword; else newOrUpload" class="password">
      <div class="input-container">
        <input
          (keydown.enter)="open()"
          #passwordEl
          [(ngModel)]="password"
          type="password"
          autocomplete="off"
        />
      </div>

      <button (click)="save()" [disabled]="!password">Save</button>
    </div>

    <ng-template #newOrUpload>
      <button (click)="createNew()">Create New</button>
      <button
        title="Upload"
        (click)="fileInput.click()"
        class="icon upload-file"
      >
        Upload
        <input
          #fileInput
          type="file"
          hidden=""
          (change)="onFileChange($event)"
        />
      </button>
    </ng-template>
  </div>

  <div class="initial" *ngSwitchCase="'secretsPresent'">
    <span>Enter password to unlock secret</span>
    <div class="password">
      <div class="input-container">
        <input
          (keydown.enter)="unlock()"
          #passwordEl
          [(ngModel)]="password"
          type="password"
          autocomplete="off"
        />
      </div>
      <button (click)="unlock()" [disabled]="!password">Unlock</button>
    </div>
  </div>

  <div class="open" *ngSwitchCase="'open'">
    <div class="toolbar">
      <input
        class="search"
        [(ngModel)]="searchTerm"
        type="search"
        placeholder="Search..."
      />
      <button title="Add" class="icon">
        <my-secret-plus-icon></my-secret-plus-icon>
      </button>
      <button (click)='saveSecrets()' [class.changed]="changed" title="Save" class="icon">
        <my-secret-save-icon></my-secret-save-icon>
      </button>
    </div>

    <div class="secret-container">
      <ng-container *ngFor="let secret of filteredSecrets">
        <input type='text' placeholder='Name' [(ngModel)]='secret.name' (ngModelChange)='onChanged()'>
        <input type='text' placeholder='User' [(ngModel)]='secret.user' (ngModelChange)='onChanged()'>
        <div class="secret-password">
          <my-secret-eye-icon
            (click)="secret.visible = !secret.visible"
          ></my-secret-eye-icon>
          <input placeholder='Password' [type]=" secret.visible ? 'text' : 'password' " [(ngModel)]='secret.password' (ngModelChange)='onChanged()'>
        </div>
        <div class="infos">
          <input type='text' placeholder='Info 0' [(ngModel)]='secret.info0' (ngModelChange)='onChanged()'>
          <input type='text' placeholder='Info 1' [(ngModel)]='secret.info1' (ngModelChange)='onChanged()'>
        </div>
      </ng-container>
    </div>
  </div>
</div>
<!--    <button [hidden]="!secrets" [class.disabled]="!password" [disabled]="!password" class="open" (click)="open()">Open</button>-->

<!--    <div class="toolbar">-->

<!--        <button [hidden]="!secrets" [disabled]="!secrets" title="Download" (click)="download()" class="icon upload-file">-->

<!--        </button>-->
<!--    </div>-->

<div class="error">{{ error }}</div>

<!--<pre>{{ state | json }}</pre>-->
<!--<pre>{{ initialPassword }}</pre>-->
